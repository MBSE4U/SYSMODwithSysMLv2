<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard - SYSMOD</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Mermaid.js -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'base', themeVariables: { fontFamily: 'Inter' } });
        window.mermaid = mermaid;
    </script>

    <!-- SortableJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            /* Slate 50 */
        }

        /* Draggable Handles */
        section h2 {
            cursor: grab;
        }

        section h2:active {
            cursor: grabbing;
        }

        /* Glassmorphism utilities */
        .glass {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .glass-dark {
            background: rgba(15, 23, 42, 0.85);
            /* Slate 900 */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Gradient Border */
        .gradient-border {
            position: relative;
            background: #fff;
            background-clip: padding-box;
            border: 2px solid transparent;
            border-radius: 0.75rem;
        }

        .gradient-border::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: -1;
            margin: -2px;
            border-radius: inherit;
            background: linear-gradient(to right, #06b6d4, #4f46e5);
            /* Cyan 500 to Indigo 600 */
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .delay-100 {
            animation-delay: 0.1s;
        }

        .delay-200 {
            animation-delay: 0.2s;
        }

        .delay-300 {
            animation-delay: 0.3s;
        }

        .delay-400 {
            animation-delay: 0.4s;
        }

        /* Hide scrollbar for clean horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#4f46e5', // Indigo 600
                            teal: '#06b6d4', // Cyan 500
                            dark: '#0f172a', // Slate 900
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(6, 182, 212, 0.3)',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <script>
    </script>
</head>

<body class="text-slate-800 antialiased selection:bg-brand-teal selection:text-white">

    <!-- Top Navigation -->
    <nav class="fixed top-0 w-full z-50 glass shadow-sm transition-all duration-300">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-tr from-brand-blue to-brand-teal p-2 rounded-lg text-white shadow-glow">
                        <i data-lucide="box" class="w-6 h-6"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-slate-900">SYSMOD<span
                            class="text-brand-blue">Viewer</span></span>
                </div>
                <!-- Breadcrumbs / Context -->
                <div
                    class="hidden md:flex items-center space-x-2 text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
                    <span>Repository</span>
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    <span class="font-medium text-slate-700" id="repository_url">Project SkyLift</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="p-2 text-slate-400 hover:text-brand-blue transition-colors">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                    </button>
                    <div
                        class="h-8 w-8 rounded-full bg-gradient-to-r from-slate-200 to-slate-300 border border-white shadow-sm overflow-hidden">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Tim" alt="User" />
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar / Settings Drawer -->
    <div id="settings_drawer"
        class="fixed right-0 top-20 bg-white/90 backdrop-blur-md shadow-lg border-l border-white/50 rounded-l-2xl p-4 transition-transform duration-300 z-40 translate-x-3/4 hover:translate-x-0 w-64 group">
        <div class="absolute -left-10 top-2 bg-white p-2 rounded-l-lg shadow-md cursor-pointer group-hover:bg-slate-50">
            <i data-lucide="settings" class="w-6 h-6 text-brand-blue animate-spin-slow"></i>
        </div>
        <h3 class="font-bold text-slate-800 mb-4 border-b pb-2">View Settings</h3>
        <div class="space-y-3">
            <label class="flex items-center space-x-2 cursor-pointer">
                <input type="checkbox" checked onchange="toggleSection('vision_section')"
                    class="w-4 h-4 text-brand-blue rounded border-slate-300 focus:ring-brand-blue">
                <span class="text-sm font-medium text-slate-700">Vision Section</span>
            </label>

            <div class="mb-6">
                <h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3">Context Views</h3>
                <div class="space-y-2">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" checked onchange="toggleSection('brownfield_context_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Brownfield Context</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('system_context_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">System Context</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('requirements_context_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Requirements Context</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('functional_context_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Functional Context</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('logical_context_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Logical Context</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('product_context_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Product Context</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('stakeholders_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Stakeholders</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" onchange="toggleSection('feature_bindings_section')"
                            class="rounded text-brand-blue focus:ring-brand-blue border-slate-300">
                        <span class="text-sm text-slate-600">Feature Bindings</span>
                    </label>
                </div>
            </div>
            <h4 class="text-xs font-semibold text-slate-400 uppercase tracking-wider mt-4 mb-2">Detailed Views</h4>
            <label class="flex items-center space-x-2 cursor-pointer">
                <input type="checkbox" onchange="toggleSection('usecases_section')"
                    class="w-4 h-4 text-brand-blue rounded border-slate-300 focus:ring-brand-blue">
                <span class="text-sm font-medium text-slate-700">Use Cases</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
                <input type="checkbox" onchange="toggleSection('requirements_section')"
                    class="w-4 h-4 text-brand-blue rounded border-slate-300 focus:ring-brand-blue">
                <span class="text-sm font-medium text-slate-700">Requirements</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
                <input type="checkbox" onchange="toggleSection('architecture_section')"
                    class="w-4 h-4 text-brand-blue rounded border-slate-300 focus:ring-brand-blue">
                <span class="text-sm font-medium text-slate-700">Architecture</span>
            </label>
        </div>
    </div>

    <main class="pt-24 pb-20 px-4 sm:px-6 lg:px-8 max-w-full mx-auto">

        <!-- Header Section -->
        <header class="mb-12 animate-fade-in">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 id="project_name" class="text-4xl font-extrabold text-slate-900 tracking-tight mb-2">Loading
                        Project...</h1>
                    <p id="project_description" class="text-slate-500 text-lg">Fetching details from SysML v2
                        Repository...</p>
                </div>
                <div class="flex items-center gap-3">
                    <span id="project_phase_badge"
                        class="inline-flex items-center px-4 py-1.5 rounded-full text-sm font-semibold bg-emerald-100 text-emerald-700 border border-emerald-200 shadow-sm"
                        style="display: none;">
                        <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2 animate-pulse"></span>
                        <span id="project_phase_text">Phase: Concept Design</span>
                    </span>
                </div>
            </div>
        </header>

        <!-- Vision Section -->
        <section id="vision_section" class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16 animate-fade-in delay-100">
            <!-- Problem Statement -->
            <div
                class="glass-dark rounded-2xl p-8 shadow-soft relative overflow-hidden group hover:shadow-xl transition-shadow duration-300">
                <div class="absolute top-0 right-0 p-6 opacity-10">
                    <i data-lucide="target" class="w-32 h-32 text-white"></i>
                </div>
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-white/10 rounded-lg backdrop-blur-sm">
                        <i data-lucide="alert-circle" class="w-6 h-6 text-red-400"></i>
                    </div>
                    <h2
                        class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-orange-300">
                        Problem Statement</h2>
                </div>
                <p id="problem_statement_text" class="text-slate-300 leading-relaxed text-lg">
                    Loading problem statement...
                </p>
            </div>

            <!-- System Idea -->
            <div class="gradient-border p-8 shadow-soft group hover:shadow-xl transition-shadow duration-300">
                <div class="absolute top-0 right-0 p-6 opacity-5">
                    <i data-lucide="lightbulb" class="w-32 h-32 text-brand-blue"></i>
                </div>
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-brand-blue/10 rounded-lg text-brand-blue">
                        <i data-lucide="zap" class="w-6 h-6"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800">System Idea</h2>
                </div>
                <p id="system_idea_text" class="text-slate-600 leading-relaxed text-lg">
                    Loading system idea...
                </p>
            </div>
        </section>

        <!-- Brownfield Context -->
        <section id="brownfield_context_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="layers" class="w-6 h-6 text-amber-600"></i>
                    Brownfield Context
                </h2>
                <button class="text-sm text-brand-blue font-medium hover:underline">View Details</button>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white">
                <div class="w-full flex justify-center">
                    <div class="mermaid w-full overflow-x-auto min-h-[600px] flex items-center justify-center">
                        graph TD;
                        Legacy[Legacy System] -.-> System((System))
                    </div>
                </div>
            </div>
        </section>

        <!-- System Context (Star Diagram) -->
        <section id="system_context_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="network" class="w-6 h-6 text-brand-teal"></i>
                    System Context
                </h2>
                <button class="text-sm text-brand-blue font-medium hover:underline">View Details</button>
            </div>

            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white">
                <div class="w-full flex justify-center">
                    <div class="mermaid w-full overflow-x-auto min-h-[600px] flex items-center justify-center">
                        graph TD
                        %% Styling
                        classDef system fill:#0f172a,stroke:#4f46e5,stroke-width:4px,color:white,shadow:0 0 15px
                        #4f46e5;
                        classDef actor fill:#f8fafc,stroke:#94a3b8,stroke-width:2px,color:#334155;

                        subgraph Context
                        direction TB
                        C[Customer]:::actor -.->|Place Order| S((Autonomous<br>Drone System)):::system
                        M[Maintenance<br>Crew]:::actor -.->|Repair| S
                        ATC[Air Traffic<br>Control]:::actor -.->|Flight Auth| S
                        API[Cloud API]:::actor <-->|Data Sync| S
                            end

                            linkStyle default stroke:#cbd5e1,stroke-width:2px,stroke-dasharray: 5 5;
                    </div>
                </div>
            </div>
        </section>

        <!-- Requirements Context Section -->
        <section id="requirements_context_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="list-checks" class="w-6 h-6 text-emerald-600"></i>
                    Requirements Context
                </h2>
                <button class="text-sm text-brand-blue font-medium hover:underline">View Details</button>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white">
                <div class="w-full flex justify-center">
                    <div class="mermaid w-full overflow-x-auto min-h-[600px] flex items-center justify-center">
                        graph TD;
                        Loading[...]
                    </div>
                </div>
            </div>
        </section>

        <!-- Stakeholders Section -->
        <section id="stakeholders_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="users" class="w-6 h-6 text-indigo-600"></i>
                    Stakeholders
                </h2>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-50">
                            <tr>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                    Name</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                    Description</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                    Contact</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                    Risk</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                    Effort</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                                    Categories</th>
                            </tr>
                        </thead>
                        <tbody id="stakeholders_table_body" class="bg-white divide-y divide-slate-200">
                            <!-- Rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Feature Bindings Section -->
        <section id="feature_bindings_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="link" class="w-6 h-6 text-pink-600"></i>
                    Feature Bindings (@FB)
                </h2>
                <button onclick="toggleFeatureBindingAxes()"
                    class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors shadow-sm">
                    <i data-lucide="arrow-left-right" class="w-4 h-4"></i>
                    Swap Axes
                </button>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead id="feature_bindings_table_head" class="bg-slate-50">
                            <!-- Helper generated headers -->
                        </thead>
                        <tbody id="feature_bindings_table_body" class="bg-white divide-y divide-slate-200">
                            <!-- Rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Functional Architecture Context -->
        <section id="functional_context_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="activity" class="w-6 h-6 text-blue-500"></i>
                    Functional Architecture Context
                </h2>
                <button class="text-sm text-brand-blue font-medium hover:underline">View Details</button>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white">
                <div class="w-full flex justify-center">
                    <div class="mermaid w-full overflow-x-auto min-h-[600px] flex items-center justify-center">
                        graph LR;
                        Input --> Func((Function)) --> Output
                    </div>
                </div>
            </div>
        </section>

        <!-- Logical Architecture Context -->
        <section id="logical_context_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="cpu" class="w-6 h-6 text-purple-600"></i>
                    Logical Architecture Context
                </h2>
                <button class="text-sm text-brand-blue font-medium hover:underline">View Details</button>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white">
                <div class="w-full flex justify-center">
                    <div class="mermaid w-full overflow-x-auto min-h-[600px] flex items-center justify-center">
                        block-beta
                        columns 3
                        block:Group1
                        A B
                        end
                        C
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Architecture Context -->
        <section id="product_context_section" class="mb-12 animate-fade-in hidden delay-200">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="package" class="w-6 h-6 text-emerald-600"></i>
                    Product Architecture Context
                </h2>
                <button class="text-sm text-brand-blue font-medium hover:underline">View Details</button>
            </div>
            <div class="glass rounded-2xl p-8 shadow-soft border border-white/50 bg-white">
                <div class="w-full flex justify-center">
                    <div class="mermaid w-full overflow-x-auto min-h-[600px] flex items-center justify-center">
                        graph TD;
                        Product --> Component1
                        Product --> Component2
                    </div>
                </div>
            </div>
        </section>

        <!-- Use Cases -->
        <section id="usecases_section" class="mb-12 animate-fade-in hidden delay-300">
            <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <i data-lucide="users" class="w-6 h-6 text-brand-blue"></i>
                Use Cases
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Card 1 -->
                <div
                    class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 hover:shadow-md hover:border-brand-blue/30 transition-all duration-300 group cursor-pointer">
                    <div class="flex justify-between items-start mb-4">
                        <span
                            class="px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-700">Customer</span>
                        <i data-lucide="package"
                            class="w-5 h-5 text-slate-300 group-hover:text-brand-blue transition-colors"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2">Request Delivery</h3>
                    <p class="text-slate-500 italic text-sm">Initiate a package delivery request specifying pickup and
                        drop-off locations.</p>
                </div>

                <!-- Card 2 -->
                <div
                    class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 hover:shadow-md hover:border-brand-blue/30 transition-all duration-300 group cursor-pointer">
                    <div class="flex justify-between items-start mb-4">
                        <span
                            class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700">Operator</span>
                        <i data-lucide="map"
                            class="w-5 h-5 text-slate-300 group-hover:text-brand-blue transition-colors"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2">Monitor Fleet</h3>
                    <p class="text-slate-500 italic text-sm">Real-time supervision of all active drones and battery
                        status.</p>
                </div>

                <!-- Card 3 -->
                <div
                    class="bg-white rounded-xl p-6 shadow-sm border border-slate-100 hover:shadow-md hover:border-brand-blue/30 transition-all duration-300 group cursor-pointer">
                    <div class="flex justify-between items-start mb-4">
                        <span
                            class="px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700">Drone</span>
                        <i data-lucide="navigation"
                            class="w-5 h-5 text-slate-300 group-hover:text-brand-blue transition-colors"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2">Execute Flight Path</h3>
                    <p class="text-slate-500 italic text-sm">Follow computed trajectory while avoiding dynamic
                        obstacles.</p>
                </div>
            </div>
        </section>

        <!-- Requirements Table -->
        <section id="requirements_section" class="mb-12 animate-fade-in hidden delay-400">
            <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <i data-lucide="list-checks" class="w-6 h-6 text-emerald-500"></i>
                Requirements
            </h2>
            <div class="bg-white rounded-xl shadow-soft overflow-hidden border border-slate-200">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr
                            class="bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-semibold tracking-wider">
                            <th class="p-4 rounded-tl-xl">ID</th>
                            <th class="p-4">Requirement</th>
                            <th class="p-4">Priority</th>
                            <th class="p-4">Status</th>
                            <th class="p-4 rounded-tr-xl text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 text-sm">
                        <tr class="hover:bg-slate-50 transition-colors">
                            <td class="p-4 font-mono text-slate-500">REQ-001</td>
                            <td class="p-4 font-medium text-slate-800">The drone must lift a payload of at least 5kg.
                            </td>
                            <td class="p-4"><span class="flex items-center gap-2">
                                    <div class="w-2.5 h-2.5 rounded-full bg-red-500"></div> High
                                </span></td>
                            <td class="p-4"><span
                                    class="px-2 py-1 rounded bg-green-100 text-green-700 font-medium text-xs">Verified</span>
                            </td>
                            <td class="p-4 text-center text-slate-400 pointer"><i data-lucide="more-horizontal"
                                    class="w-4 h-4 mx-auto cursor-pointer hover:text-brand-blue"></i></td>
                        </tr>
                        <tr class="hover:bg-slate-50 transition-colors">
                            <td class="p-4 font-mono text-slate-500">REQ-002</td>
                            <td class="p-4 font-medium text-slate-800">Flight time must exceed 45 minutes on a single
                                charge.</td>
                            <td class="p-4"><span class="flex items-center gap-2">
                                    <div class="w-2.5 h-2.5 rounded-full bg-red-500"></div> High
                                </span></td>
                            <td class="p-4"><span
                                    class="px-2 py-1 rounded bg-yellow-100 text-yellow-700 font-medium text-xs">In
                                    Progress</span></td>
                            <td class="p-4 text-center text-slate-400 pointer"><i data-lucide="more-horizontal"
                                    class="w-4 h-4 mx-auto cursor-pointer hover:text-brand-blue"></i></td>
                        </tr>
                        <tr class="hover:bg-slate-50 transition-colors">
                            <td class="p-4 font-mono text-slate-500">REQ-003</td>
                            <td class="p-4 font-medium text-slate-800">System must encrypt all communication via
                                AES-256.</td>
                            <td class="p-4"><span class="flex items-center gap-2">
                                    <div class="w-2.5 h-2.5 rounded-full bg-blue-500"></div> Medium
                                </span></td>
                            <td class="p-4"><span
                                    class="px-2 py-1 rounded bg-slate-100 text-slate-600 font-medium text-xs">Draft</span>
                            </td>
                            <td class="p-4 text-center text-slate-400 pointer"><i data-lucide="more-horizontal"
                                    class="w-4 h-4 mx-auto cursor-pointer hover:text-brand-blue"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Architecture (Block Diagram) -->
        <section id="architecture_section" class="mb-12 animate-fade-in hidden delay-400">
            <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <i data-lucide="cpu" class="w-6 h-6 text-purple-500"></i>
                Logical Architecture
            </h2>
            <div
                class="glass rounded-2xl p-8 shadow-soft bg-white border border-slate-200 overflow-x-auto no-scrollbar">
                <div class="flex items-center min-w-max space-x-6">

                    <!-- Block 1 -->
                    <div class="flex flex-col items-center gap-3">
                        <div
                            class="w-32 h-24 bg-white border-2 border-slate-200 rounded-lg shadow-sm flex flex-col items-center justify-center p-2 relative group hover:border-brand-blue hover:shadow-lg transition-all">
                            <i data-lucide="navigation-2"
                                class="w-8 h-8 text-slate-400 group-hover:text-brand-blue transition-colors mb-2"></i>
                            <span class="text-xs font-bold text-slate-700 text-center">Navigation<br>Module</span>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="text-slate-300"><i data-lucide="arrow-right" class="w-6 h-6"></i></div>

                    <!-- Block 2 -->
                    <div class="flex flex-col items-center gap-3">
                        <div
                            class="w-32 h-24 bg-white border-2 border-slate-200 rounded-lg shadow-sm flex flex-col items-center justify-center p-2 relative group hover:border-brand-blue hover:shadow-lg transition-all">
                            <i data-lucide="cpu"
                                class="w-8 h-8 text-slate-400 group-hover:text-brand-blue transition-colors mb-2"></i>
                            <span class="text-xs font-bold text-slate-700 text-center">Flight<br>Controller</span>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="text-slate-300"><i data-lucide="arrow-right" class="w-6 h-6"></i></div>

                    <!-- Block 3 -->
                    <div class="flex flex-col items-center gap-3">
                        <div
                            class="w-32 h-24 bg-white border-2 border-slate-200 rounded-lg shadow-sm flex flex-col items-center justify-center p-2 relative group hover:border-brand-blue hover:shadow-lg transition-all">
                            <i data-lucide="battery-charging"
                                class="w-8 h-8 text-slate-400 group-hover:text-brand-blue transition-colors mb-2"></i>
                            <span class="text-xs font-bold text-slate-700 text-center">Power<br>Plant</span>
                        </div>
                    </div>

                    <!-- Branch Out arrow -->
                    <div class="text-slate-300"><i data-lucide="arrow-right" class="w-6 h-6"></i></div>

                    <!-- Block 4 -->
                    <div class="flex flex-col items-center gap-3">
                        <div
                            class="w-32 h-24 bg-white border-2 border-slate-200 rounded-lg shadow-sm flex flex-col items-center justify-center p-2 relative group hover:border-brand-blue hover:shadow-lg transition-all">
                            <i data-lucide="box"
                                class="w-8 h-8 text-slate-400 group-hover:text-brand-blue transition-colors mb-2"></i>
                            <span class="text-xs font-bold text-slate-700 text-center">Payload<br>Bay</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-20 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-slate-400 text-sm">
            &copy; 2025 MBSE4U. Generated with SysML v2 API.
        </div>
    </footer>

    <!-- Initialize Lucide Icons -->
    <script>
        lucide.createIcons();

        // ---------------------------------------------------------
        // Dynamic Data Integration & View Settings
        // ---------------------------------------------------------

        const params = new URLSearchParams(window.location.search);
        const serverUrl = params.get('server_url');
        const projectId = params.get('project_id');
        const commitId = params.get('commit_id');
        const sysmodProjectId = params.get('sysmod_project_id');

        let currentProjectData = null;
        const loadedSections = new Set();

        // Map Section IDs to their specialized render functions
        const sectionRenderers = {
            'vision_section': renderVision,
            'brownfield_context_section': () => renderSysmodContext('brownfield_context_section', 'brownfieldSystemContext', 'System of Interest'),
            'system_context_section': () => renderSysmodContext('system_context_section', 'systemIdeaContext', 'System Idea'),
            'requirements_context_section': () => renderSysmodContext('requirements_context_section', 'requirementSystemContext', 'System'),
            'functional_context_section': () => renderSysmodContext('functional_context_section', 'functionalSystemContext', 'System'),
            'logical_context_section': () => renderSysmodContext('logical_context_section', 'logicalSystemContext', 'System'),
            'product_context_section': () => renderSysmodContext('product_context_section', 'productSystemContext', 'System'),
            'feature_bindings_section': renderFeatureBindings,
            'usecases_section': renderUseCases,
            'requirements_section': renderRequirements,
            'architecture_section': renderArchitecture,
            'stakeholders_section': renderStakeholders
        };

        // Update Repository Breadcrumb
        if (serverUrl) {
            document.getElementById('repository_url').textContent = serverUrl;
        }

        // Initialize
        if (serverUrl && projectId && commitId && sysmodProjectId) {
            fetchProjectData();
        } else {
            document.getElementById('project_name').textContent = "Missing Parameters";
        }

        // Initialize SortableJS
        if (typeof Sortable !== 'undefined') {
            new Sortable(document.querySelector('main'), {
                animation: 150,
                handle: 'h2',
                draggable: 'section',
                ghostClass: 'bg-slate-100',
                onEnd: function (evt) {
                    console.log('Section moved:', evt.item.id);
                }
            });
        }

        async function fetchProjectData() {
            if (!sysmodProjectId) return;

            try {
                const response = await fetch('/api/element', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        element_id: sysmodProjectId
                    })
                });

                if (response.ok) {
                    currentProjectData = await response.json();

                    // Update Header
                    const name = currentProjectData.name || currentProjectData['@id'] || "Untitled Project";
                    document.getElementById('project_name').textContent = name;
                    document.title = `${name} - Dashboard`;
                    let description = "No description available.";
                    if (currentProjectData.documentation) {
                        if (typeof currentProjectData.documentation === 'object') {
                            description = currentProjectData.documentation.body || currentProjectData.documentation.name || "";
                        } else {
                            description = currentProjectData.documentation;
                        }
                    }
                    document.getElementById('project_description').textContent = description;
                    document.getElementById('project_phase_badge').style.display = 'inline-flex';

                    console.log("Project Data Loaded:", currentProjectData);

                    // Restore views (which will trigger lazy loading)
                    restoreViewSettings();

                } else {
                    console.error("Failed to fetch project data");
                    document.getElementById('project_name').textContent = "Error Loading Project";
                }
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('project_name').textContent = "Connection Error";
            }
        }

        function restoreViewSettings() {
            const storageKey = `sysmod_views_${sysmodProjectId}`;
            let settings = {};
            try {
                settings = JSON.parse(localStorage.getItem(storageKey)) || {};
            } catch (e) { console.error("Error reading settings", e); }

            // Default: only Vision is visible if no settings found
            const isFirstVisit = Object.keys(settings).length === 0;

            // Iterate through registered sections
            for (const sectionId in sectionRenderers) {
                const checkbox = document.querySelector(`input[onchange*="${sectionId}"]`);
                const section = document.getElementById(sectionId);

                if (!checkbox || !section) continue;

                let isVisible = false;
                if (isFirstVisit) {
                    isVisible = (sectionId === 'vision_section');
                } else {
                    isVisible = settings[sectionId] === true;
                }

                // Apply state
                checkbox.checked = isVisible;
                if (isVisible) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }

                // Load data if visible
                if (isVisible) {
                    loadSectionData(sectionId);
                }
            }
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const checkbox = document.querySelector(`input[onchange*="${sectionId}"]`);
            if (section && checkbox) {
                const isVisible = checkbox.checked;

                if (isVisible) {
                    section.classList.remove('hidden');
                    section.classList.add('animate-fade-in');
                } else {
                    section.classList.add('hidden');
                }

                // Save to local storage
                const storageKey = `sysmod_views_${sysmodProjectId}`;
                let settings = {};
                try {
                    settings = JSON.parse(localStorage.getItem(storageKey)) || {};
                } catch (e) { }
                settings[sectionId] = isVisible;
                localStorage.setItem(storageKey, JSON.stringify(settings));

                // Lazy load if turning on
                if (isVisible) {
                    loadSectionData(sectionId);
                }
            }
        }

        function loadSectionData(sectionId) {
            if (!currentProjectData) return; // Not ready yet
            if (loadedSections.has(sectionId)) return; // Already loaded

            const renderer = sectionRenderers[sectionId];
            if (renderer) {
                console.log(`Lazy loading ${sectionId}...`);
                renderer(currentProjectData);
                loadedSections.add(sectionId);
            }
        }

        // Render Functions
        // Generic Render Context Function
        async function renderSysmodContext(sectionId, contextType, defaultTitle) {
            console.log(`Rendering ${contextType} for ${sectionId}...`);
            const container = document.querySelector(`#${sectionId} .mermaid`);
            if (!container) return;

            try {
                const response = await fetch('/api/sysmod-context', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        sysmod_project_id: sysmodProjectId,
                        context_type: contextType
                    })
                });

                if (response.ok) {
                    const data = await response.json();

                    if (data && data.context) {
                        let systemName = defaultTitle;
                        if (data.system && data.system.name) systemName = data.system.name;

                        let graphDef = `graph TD;\n`;

                        // System Subgraph
                        graphDef += `subgraph SystemBox ["${systemName}"]\n`;
                        graphDef += `direction TB\n`;

                        // Internal Parts
                        console.log("System Context Data:", data);
                        let hasParts = false;
                        if (data.system && data.system.parts && data.system.parts.length > 0) {
                            data.system.parts.forEach((part, i) => {
                                const partName = (part.name || "Part").replace(/["\n\r]/g, '');
                                graphDef += `Part${i}["«part»<br/>${partName}"]\n`;
                                graphDef += `style Part${i} fill:#ffffff,stroke:#334155,stroke-width:1px,color:#0f172a;\n`;
                                hasParts = true;
                            });
                        }

                        graphDef += `end\n`; // End Subgraph

                        // Style SystemBox
                        graphDef += `style SystemBox fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e40af;\n`;

                        // Actors
                        if (data.actors && data.actors.length > 0) {
                            data.actors.forEach((actor, index) => {
                                const actorId = `Actor${index}`;
                                const actorName = actor.name || "Actor";
                                graphDef += `${actorId}["${actorName}"] --- SystemBox;\n`;
                                graphDef += `style ${actorId} fill:#f8fafc,stroke:#94a3b8,stroke-width:1px,color:#334155;\n`;
                            });
                        } else {
                            graphDef += `NoActors["No Actors Found"] -.-> SystemBox;\n`;
                            graphDef += `style NoActors stroke-dasharray: 5 5;\n`;
                        }

                        if (window.mermaid) {
                            container.textContent = graphDef;
                            container.removeAttribute('data-processed');
                            try {
                                await window.mermaid.run({ nodes: [container] });
                                // Initialize Pan Zoom
                                const svg = container.querySelector('svg');
                                if (svg) {
                                    // Remove max-width to allow zooming properly
                                    svg.style.maxWidth = 'none';
                                    svg.style.height = '600px';
                                    svg.style.width = '100%';

                                    svgPanZoom(svg, {
                                        zoomEnabled: true,
                                        controlIconsEnabled: true,
                                        fit: true,
                                        center: true,
                                        minZoom: 0.1,
                                        maxZoom: 10
                                    });
                                }
                            } catch (err) {
                                console.error("Mermaid run error:", err);
                                container.textContent = `graph TD;\nError[Rendering Error];`;
                                window.mermaid.run({ nodes: [container] });
                            }
                        }
                    } else {
                        console.warn(`${contextType} not found.`);
                        container.textContent = "graph TD; Error[Context Not Found]; style Error fill:#fee2e2,stroke:#ef4444;";
                        container.removeAttribute('data-processed');
                        if (window.mermaid) {
                            window.mermaid.run({ nodes: [container] });
                        }
                    }
                }
            } catch (e) { console.error(e); }
        }

        // Render Stakeholders
        async function renderStakeholders(projectData) {
            console.log("Rendering Stakeholders...");
            try {
                const response = await fetch('/api/stakeholders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        sysmod_project_id: sysmodProjectId
                    })
                });

                if (response.ok) {
                    const stakeholders = await response.json();
                    const tbody = document.getElementById('stakeholders_table_body');
                    if (tbody) {
                        tbody.innerHTML = '';
                        stakeholders.forEach(s => {
                            const tr = document.createElement('tr');
                            tr.className = "hover:bg-slate-50 transition-colors";
                            tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${s.name || 'Unnamed'}</td>
                            <td class="px-6 py-4 text-sm text-slate-500 min-w-[400px] max-w-3xl whitespace-normal break-words">${s.description || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${s.contact || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${s.risk || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${s.effort || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${(s.categories || []).join ? (s.categories || []).join(', ') : s.categories}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                        if (stakeholders.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-slate-400">No stakeholders found.</td></tr>';
                        }
                    }
                }
            } catch (e) { console.error(e); }
        }




        let currentFeatureBindings = [];
        let isFeatureBindingSwapped = false;

        function toggleFeatureBindingAxes() {
            isFeatureBindingSwapped = !isFeatureBindingSwapped;
            renderFeatureBindingsTable();
        }

        function renderFeatureBindingsTable() {
            const bindings = currentFeatureBindings;
            const thead = document.getElementById('feature_bindings_table_head');
            const tbody = document.getElementById('feature_bindings_table_body');

            if (!thead || !tbody) return;

            thead.innerHTML = '';
            tbody.innerHTML = '';

            if (!bindings || bindings.length === 0) {
                thead.innerHTML = '<tr><th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Feature Bindings</th></tr>';
                tbody.innerHTML = '<tr><td class="px-6 py-4 text-center text-slate-400">No feature bindings found.</td></tr>';
                return;
            }

            // Extract unique Clients and Suppliers Objects {name, id}
            // Use dicts to deduplicate by ID
            const clientMap = {};
            const supplierMap = {};

            bindings.forEach(b => {
                if (b.client && b.client.id) clientMap[b.client.id] = b.client.name;
                if (b.supplier && b.supplier.id) supplierMap[b.supplier.id] = b.supplier.name;
            });

            // Convert to arrays and sort by name
            const clients = Object.keys(clientMap).map(id => ({ id, name: clientMap[id] })).sort((a, b) => a.name.localeCompare(b.name));
            const suppliers = Object.keys(supplierMap).map(id => ({ id, name: supplierMap[id] })).sort((a, b) => a.name.localeCompare(b.name));

            // Determine Rows and Columns based on state
            const rowHeaders = isFeatureBindingSwapped ? suppliers : clients;
            const colHeaders = isFeatureBindingSwapped ? clients : suppliers;
            const topLeftText = isFeatureBindingSwapped ? "Supplier \\ Client" : "Client \\ Supplier";

            // --- Generate Header Row ---
            const headerTr = document.createElement('tr');
            // Top-left cell
            const thFirst = document.createElement('th');
            thFirst.className = "px-6 py-3 text-left text-xs font-bold text-slate-700 uppercase tracking-wider bg-slate-100 border-b border-r border-slate-200";
            thFirst.innerText = topLeftText;
            headerTr.appendChild(thFirst);

            colHeaders.forEach(col => {
                const th = document.createElement('th');
                th.className = "px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider border-b border-slate-200 min-w-[100px]";
                th.innerText = col.name;
                th.title = col.id; // Tooltip for ID
                headerTr.appendChild(th);
            });
            thead.appendChild(headerTr);

            // --- Generate Body Rows ---
            rowHeaders.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors";

                // Row Header
                const tdRowHeader = document.createElement('td');
                tdRowHeader.className = "px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 border-r border-slate-200 bg-white sticky left-0";
                tdRowHeader.innerText = row.name;
                tdRowHeader.title = row.id;
                tr.appendChild(tdRowHeader);

                // Matrix Cells
                colHeaders.forEach(col => {
                    const td = document.createElement('td');
                    td.className = "px-6 py-4 whitespace-nowrap text-center text-sm border-slate-100 border cursor-pointer hover:bg-slate-100 transition-colors select-none";

                    // Determine Client and Supplier IDs for this cell
                    const clientId = isFeatureBindingSwapped ? col.id : row.id;
                    const supplierId = isFeatureBindingSwapped ? row.id : col.id;

                    // Check if binding exists
                    const exists = bindings.some(b => b.client.id === clientId && b.supplier.id === supplierId);

                    if (exists) {
                        td.innerHTML = '<span class="text-emerald-600 font-bold">x</span>';
                        td.classList.add("bg-emerald-50");
                    } else {
                        td.innerText = "-";
                        td.classList.add("text-slate-300");
                    }

                    // Click Handler
                    td.onclick = () => toggleBindingState(td, clientId, supplierId);

                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            if (window.lucide) window.lucide.createIcons();
        }

        async function toggleBindingState(cell, clientId, supplierId) {
            // Visual feedback
            const originalContent = cell.innerHTML;
            cell.innerHTML = '<div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-slate-600"></div>';
            cell.classList.add("opacity-50", "pointer-events-none");

            try {
                const response = await fetch('/api/feature-bindings/toggle', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        client_id: clientId,
                        supplier_id: supplierId
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        // Update local model
                        if (result.action === 'created') {
                            // Fetch names for local update (assume known from context, but tricky)
                            // We can just query the `clientMap` we constructed or rebuild the object
                            // simpler: re-fetch or reconstruct from row/col
                            // Actually, I need to add to `currentFeatureBindings`.
                            // I need the NAMES for client/supplier to add to local cache for re-render consistency,
                            // OR I trust the next render to pick them up if I had them.
                            // But wait, the client/supplier DEFINITIONS are already in the headers. I can look them up.

                            // Find client/supplier names from existing bindings (if any) or...
                            // Actually, we don't have a global lookup if they had 0 bindings before.
                            // But here we clicked a cell intersection of X and Y, so X and Y MUST describe rows/cols,
                            // so they ARE in our headers.

                            // Better: Just fetch the updated list or hack it.
                            // Fetching whole list is safest but slower.
                            // Let's hack it:
                            // We need to find ONE binding with client.id == clientId to get the name, same for supplier.

                            const cObj = currentFeatureBindings.find(b => b.client.id === clientId)?.client || { id: clientId, name: cell.closest('tr').querySelector(`td[title="${clientId}"]`)?.innerText || "Unknown Client" };
                            const sObj = currentFeatureBindings.find(b => b.supplier.id === supplierId)?.supplier || { id: supplierId, name: document.querySelector(`#feature_bindings_table_head th[title="${supplierId}"]`)?.innerText || "Unknown Supplier" };

                            if (cObj && sObj) {
                                currentFeatureBindings.push({
                                    id: result.id,
                                    client: cObj,
                                    supplier: sObj
                                });
                            }
                        } else {
                            // Deleted
                            currentFeatureBindings = currentFeatureBindings.filter(b => !(b.client.id === clientId && b.supplier.id === supplierId));
                        }

                        renderFeatureBindingsTable();
                        return;
                    }
                }
            } catch (e) {
                console.error("Toggle failed", e);
            }

            // Revert on failure
            cell.innerHTML = originalContent;
            cell.classList.remove("opacity-50", "pointer-events-none");
            alert("Failed to update binding.");
        }

        // Render Feature Bindings
        async function renderFeatureBindings(projectData) {
            console.log("Rendering Feature Bindings...");
            if (currentFeatureBindings && currentFeatureBindings.length > 0) {
                renderFeatureBindingsTable();
                return;
            }

            try {
                const response = await fetch('/api/feature-bindings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        sysmod_project_id: sysmodProjectId
                    })
                });

                if (response.ok) {
                    currentFeatureBindings = await response.json();
                    renderFeatureBindingsTable();
                }
            } catch (e) { console.error("Error loading bindings", e); }
        }

        // Render Vision Section
        async function renderVision(projectData) {
            console.log("Rendering Vision...", projectData);
            try {
                const response = await fetch('/api/problem-statement', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        sysmod_project_id: sysmodProjectId
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log("Problem Statement:", data);
                    if (data) {
                        document.getElementById('problem_statement_text').textContent = data.body;
                    } else {
                        document.getElementById('problem_statement_text').textContent = "Problem statement not found in model.";
                    }

                }
            } catch (e) {
                console.error("Error fetching problem statement:", e);
                document.getElementById('problem_statement_text').textContent = "Error loading data.";
            }

            // Fetch System Idea
            try {
                const responseIdea = await fetch('/api/system-idea', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        server_url: serverUrl,
                        project_id: projectId,
                        commit_id: commitId,
                        sysmod_project_id: sysmodProjectId
                    })
                });

                if (responseIdea.ok) {
                    const ideaDoc = await responseIdea.json();
                    console.log("System Idea Doc:", ideaDoc);
                    if (ideaDoc) {
                        document.getElementById('system_idea_text').textContent = ideaDoc.body;
                    } else {
                        document.getElementById('system_idea_text').textContent = "System Idea not defined.";
                    }
                }
            } catch (e) {
                console.error("Error fetching system idea:", e);
                document.getElementById('system_idea_text').textContent = "Error loading data.";
            }
        }

        function renderContext(data) { console.log("Rendering Context...", data); }
        function renderUseCases(data) { console.log("Rendering Use Cases...", data); }
        function renderRequirements(data) { console.log("Rendering Requirements...", data); }
        function renderArchitecture(data) { console.log("Rendering Architecture...", data); }

    </script>
</body>

</html>